{% extends "escapegame/base.html" %}
{% load i18n %}
{% load static %}
{% block header %}{% include "escapegame/head.html" %}
	<script src="{% static 'js/script.js' %}"></script>
{% endblock %}
{% block content %}

		<div class="title">
			<h1>{{ game.name }}</h1>
		</div>

		<!-- Game controls -->
		<div class="col head_block">

			<!-- Escape game controls -->
			<label class="head_block head_border">{% trans "Escape game controls" %}</label>
			<div class="row head_block">
				<div class="col">

					<!-- Reset escape game button -->
					<button id="reset-escapegame" value="{{ game.slug }}" type="submit">
						<div class="image-with-caption">
							<img src="{% static 'img/icons8-reset-100.png' %}" title="{% trans "Reset escape game" %}">
							<p>{% trans "Reset escape game" %}</p>
						</div>
					</button>
				</div>
			</div>

			<!-- Video controls -->
			<label class="head_block head_border">{% trans "Video controls" %}</label>
			<div class="row head_block">

				<!-- Video lists-->
				<div class="col">

					<div class="row">
						<select id="selected-video" class="head_block form-control mx-auto select-media">{% for video in videos %}
							<option name="{{ video.video_name }}" value="{{ video.slug }}" {% if video.slug == game.briefing_video.slug %} selected{% endif %}>
								{% trans "Video" %} - {{ video.video_name }}
							</option>{% endfor %}
						</select>
					</div>

					<div class="row">
						<div class="col radio radio-raspi">

{% for raspi in raspberry_pis %}
							{% if raspi.media_type == "video" %}
							<label class="row mx-auto">
								<input class="col-1" name="selected-raspberry-pi-video"  data-raspi-url="{{ raspi.url }}" type="radio"{% if not raspi.online %} disabled{% elif raspi == raspberry_pis.0 %} checked{% endif %}>
								&nbsp;
								<span class="col-8 text-left">{% trans "Raspberry Pi" %} - {{ raspi.name }}&nbsp;</span>
								<span class="col-2 text-center badge badge-{{ raspi.badge }}" id="raspberry-pi-{{ raspi.slug }}">{{ raspi.status }}</span>
							</label>
							{% endif %}
{% endfor %}
						</div>
					</div>

					<div class="row">
						<div class="col">

							<!-- Play video button -->
							<button id="video-play" type="submit">
								<div class="image-with-caption">
									<img src="{% static 'img/icons8-play-100.png' %}" title="{% trans "Play video" %}">
									<p>{% trans "Start video" %}</p>
								</div>
							</button>

							<!-- Pause video button -->
							<button id="video-pause" type="submit" class="d-none">
								<div class="image-with-caption">
									<img src="{% static 'img/icons8-pause-100.png' %}" title="{% trans "Pause video" %}">
									<p>{% trans "Pause video" %}</p>
								</div>
							</button>

							<!-- Stop video button -->
							<button id="video-stop" type="submit">
								<div class="image-with-caption">
									<img src="{% static 'img/icons8-stop-100.png' %}" title="{% trans "Stop video" %}">
									<p>{% trans "Stop video" %}</p>
								</div>
							</button>

						</div>
					</div>

				</div>

			</div>

<!-- Audio controls -->
			<label class="head_block head_border">{% trans "Audio controls" %}</label>
			<div class="row head_block">

				<!-- Audio lists-->
				<div class="col">

					<div class="row">
						<select id="selected-audio" class="head_block form-control mx-auto select-media">{% for audio in audios %}
							<option name="{{ audio.audio_name }}" value="{{ audio.slug }}">
								{% trans "Audio" %} - {{ audio.audio_name }}
							</option>{% endfor %}
						</select>
					</div>

					<div class="row">
						<div class="col radio radio-raspi">

						{% for raspi in raspberry_pis %}
							{% if raspi.media_type == "audio" %}
							<label class="row mx-auto">
								<input class="col-1" name="selected-raspberry-pi-audio"  data-raspi-url="{{ raspi.url }}" type="radio"{% if not raspi.online %} disabled{% elif raspi == raspberry_pis.0 %} checked{% endif %}>
								&nbsp;
								<span class="col-8 text-left">{% trans "Raspberry Pi" %} - {{ raspi.name }}&nbsp;</span>
								<span class="col-2 text-center badge badge-{{ raspi.badge }}" id="raspberry-pi-{{ raspi.slug }}">{{ raspi.status }}</span>
							</label>
							{% endif %}
						{% endfor %}
						</div>
					</div>

					<div class="row">
						<div class="col">

							<!-- Play audio button -->
							<button id="audio-play" type="submit">
								<div class="image-with-caption">
									<img src="{% static 'img/icons8-play-100.png' %}" title="{% trans "Play audio" %}">
									<p>{% trans "Start audio" %}</p>
								</div>
							</button>

							<!-- Pause audio button -->
							<button id="audio-pause" type="submit" class="d-none">
								<div class="image-with-caption">
									<img src="{% static 'img/icons8-pause-100.png' %}" title="{% trans "Pause audio" %}">
									<p>{% trans "Pause audio" %}</p>
								</div>
							</button>

							<!-- Stop audio button -->
							<button id="audio-stop" type="submit">
								<div class="image-with-caption">
									<img src="{% static 'img/icons8-stop-100.png' %}" title="{% trans "Stop audio" %}">
									<p>{% trans "Stop audio" %}</p>
								</div>
							</button>

						</div>
					</div>

				</div>

			</div>

			<!-- Lift controls -->
			<label class="head_block head_border">{% trans "Lift controls" %}</label>
			<div class="row head_block">
				<div class="col"></div>
		{% if game.lifts|length < 1 %}
			<p>{% trans "No lift available for this escape game." %} {% trans "You can visit" %} <a href="/{{ request.LANGUAGE_CODE }}/admin/controllers/liftgpio/">{% trans "this" %}</a> {% trans "page to create new lifts." %}</p>
		{% else %}
			{% for lift in game.lifts %}
				{% with lift_prefix=lift.name|slice:"0:1"|lower lift_suffix=lift.name|slice:"1:" %}
	            {% with lift_name=lift_prefix|add:lift_suffix %}

				<div class="col">

					<!-- Raise lift button -->
					<button id="raise-{{ game.slug }}-{{ lift.slug }}" class="raise-lift{% if lift.raised %} button-disabled{% endif %}" value="{{ lift.url_callback }}/raise/" type="submit">
						<img src="{% static 'img/icons8-raise-100.png' %}" title="{% trans "Raise lift" %} {{ lift_name }}">
					</button>

					<!-- Lower lift button -->
					<button id="lower-{{ game.slug }}-{{ lift.slug }}" class="lower-lift{% if not lift.raised %} button-disabled{% endif %}" value="{{ lift.url_callback }}/lower/" type="submit">
						<img src="{% static 'img/icons8-lower-100.png' %}" title="{% trans "Lower lift" %} {{ lift_name }}">
					</button>

					<label for="lower-{{ game.slug }}-{{ lift.slug }}" class="image-with-caption">
						<p>{% trans "Lift" %} {{ lift_name }}</p>
					</label>

				</div>
				{% endwith %}
				{% endwith %}
			{% endfor %}
		{% endif %}
				<div class="col"></div>
			</div>

			<!-- Doors controls -->
			<label class="head_block head_border">{% trans "Corridor door controls" %}</label>
			<div class="row head_block">
				<div class="col">

			{% if game.doors|length < 1 %}
				<p>{% trans "No door available for this escape game." %} {% trans "You can visit" %} <a href="/{{ request.LANGUAGE_CODE }}/admin/controllers/doorgpio/">{% trans "this" %}</a> {% trans "page to create new doors." %}</p>
			{% else %}
				{% for door in game.doors %}
					{% with door_prefix=door.name|slice:"0:1"|lower door_suffix=door.name|slice:"1:" %}
					{% with door_name=door_prefix|add:door_suffix %}


					<button class="unlock-button{% if not door.locked %} d-none{% endif %}" id="unlock-{{ game.slug }}-extra-{{ door.slug }}" value="{{ door.url_callback }}/unlock/" type="submit">
						<div class="image-with-caption">
							<img src="{% static 'img/icons8-locked-100.png' %}" title="{% trans "Unlock" %} {{ door_name }}">
							<p>{% trans "Unlock" %} {{ door_name }}</p>
						</div>
					</button>
					<button class="lock-button{% if door.locked %} d-none{% endif %}" id="lock-{{ game.slug }}-extra-{{ door.slug }}" value="{{ door.url_callback }}/lock/" type="submit">
						<div class="image-with-caption">
							<img src="{% static 'img/icons8-unlocked-100.png' %}" title="{% trans "Lock" %} {{ door_name }}">
							<p>{% trans "Lock" %} {{ door_name }}</p>
						</div>
					</button>

					{% endwith %}
					{% endwith %}
				{% endfor %}
			{% endif %}
				</div>
			</div>

			<!-- Escape game counter -->
			<label class="head_block head_border">{% trans "Time Elapsed" %}</label>
			<div class="row head_block" style="text-align: center;">
				<div class="col">
					<font size="18">
						<div id="counter">
							0:00:00
						</div>
					</font>
				</div>
			</div>
		</div>
{% if rooms|length < 1 %}
		<!-- Room controls -->
		<div class="col head_block">
			<span>
				<p>
					{% trans "No room configured yet for this escape game." %}
					<br>
					{% trans "You can visit" %}
					<a href="/{{ request.LANGUAGE_CODE }}/admin/escapegame/escapegameroom/">
						{% trans "this" %}
					</a>
					{% trans "page to create new rooms." %}
				</p>
			</span>
		</div>
{% else %}{% for room in rooms %}
		<!-- Room controls -->
		<div class="col head_block" id="{{ room.slug }}">
			<label class="head_block head_border">&laquo;&nbsp;{{ room.name }}&nbsp;&raquo;</label>
			<div class="row head_block">

			{% if room.challs|length < 1 %}
				<!-- Challenge controls -->
				<div class="col">
					<span>
						<p>
							{% trans "No challenge configured yet for this room." %}
							<br>
							{% trans "You can visit" %}
							<a href="/admin/escapegame/escapegamechallenge">
								{% trans "this" %}
							</a>
							{% trans "page to create new challenges." %}
						</p>
					</span>
				</div>
			{% else %}
				<!-- Challenge controls -->
				<div class="col">
					<table class="challenge-status">
						<tr>
							<th>{% trans "Challenge" %}</th>
							<th>{% trans "Status" %}</th>
						</tr>
					{% for chall in room.challs %}
						<tr>
							<td width="80%">{{ chall.name }}</td>
							<td width="20%">
							<a class="challenge-reset{% if not chall.gpio.solved %} d-none{% endif %}" href="{{ chall.url_callback }}/reset/" id="reset-{{ game.slug }}-{{ chall.slug }}">
								<img src="{% static 'admin/img/icon-yes.svg' %}" />
							</a>
							<a class="challenge-validate{%if chall.gpio.solved %} d-none{% endif %}" href="{{ chall.url_callback }}/validate/" id="validate-{{ game.slug}}-{{ chall.slug }}">
								<img src="{% static 'admin/img/icon-no.svg' %}"/>
							</a>
							</td>
						</tr>
					{% endfor %}
					</table>
				</div>
			{% endif %}
				<div class="col col-lg-4">
					{% with door_prefix=room.name|slice:"0:1"|lower door_suffix=room.name|slice:"1:" %}
					{% with door_name=door_prefix|add:door_suffix %}
					<button class="unlock-button{% if not room.door.locked %} d-none{% endif %}" id="unlock-{{ game.slug }}-{{ room.slug }}-{{ room.door.slug }}" value="{{ room.url_callback }}/unlock/" type="submit">
						<div class="image-with-caption">
							<img src="{% static 'img/icons8-locked-100.png' %}" title="{% trans "Unlock" %} {{ door_name }}">
							<p>{% trans "Unlock" %} {{ door_name }}</p>
						</div>
					</button>
					<button class="lock-button{% if room.door.locked %} d-none{% endif %}" id="lock-{{ game.slug }}-{{ room.slug }}-{{ room.door.slug }}" value="{{ room.url_callback }}/lock/" type="submit">
						<div class="image-with-caption">
							<img src="{% static 'img/icons8-unlocked-100.png' %}" title="{% trans "Lock" %} {{ door_name }}">
							<p>{% trans "Lock" %} {{ door_name }}</p>
						</div>
					</button>
					{% endwith %}
					{% endwith %}
				</div>
			</div>
		</div>
{% endfor %}{% endif %}
		<!-- Map -->
		<div class="col head_block">
			<label class="head_block head_border">{% trans "Map" %}</label>
			<div class="col head_block">
				{% if not game.map_image %}<span>{% trans "No map data available." %}</span>{% else %}<canvas id="map" class="col head_block" width="1648" height="904"></canvas>{% endif %}
			</div>
		</div>

{% endblock %}
